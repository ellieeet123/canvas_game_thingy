// last minified 28.4.22
function setVars(a,b){window.gameRunning=!0,window.playerDied=!1,window.base_rng_seed=a,window.playerPos={x:0,y:0},window.cameraPos={x:0,y:0},window.time=0,window.fps=0,window.mspf=0,window.targetFps=60,window.mspt=30,window.headstart=10,window.difficulty=b,window.gravityData={on:!0,active:!0,activeLastTick:!0,timeFallen:2,prevFall:0},window.jumping=!1,window.jumpedTick=0,window.lastTickTime=0,window.tickNumber=0,window.playerSpeed=7,window.playerSize=50,window.keydata={any:!1,arrows:{up:!1,down:!1,left:!1,right:!1}},window.rngData={},window.lineData={},window.collisionschecked=0,window.rngsGenerated=0,window.skippedTicks=0,window.objects={rectangles:[{startx:-100,starty:-50,endx:200,endy:-70,color:"#ff0000",collide:!0}],spikes:[],circles:[]},window.generatorConfig={lineChance:60,rightChance:45,crazyness:50,minLength:1e3,maxLength:1200,minSlope:.5,maxSlope:2,smallSlopeChance:70,minBlockDensity:5,maxBlockDensity:7,minBlockWidth:80,maxBlockWidth:200,blockHeight:15,minLineHeight:50,maxLineHeight:200,minSpikeBlockChance:10,maxSpikeBlockChance:20,minRandomSpikeChance:6,maxRandomSpikeChance:10,colors:{rectanglesNormal:["#df2a2a","#2a2adf","#2adf2a","#fcba03","#0be35e","#700ff7","#0da5d4","#d6510f","#f7f70f","#ed2da4"]}}}function background(a,b){let c=document.getElementById("canvas"),d=c.getContext("2d");c.onclick=()=>{};let e=0;d.clearRect(0,0,c.width,c.height),d.fillStyle="#151515";for(let f=-150;f<c.width+100;f+=50)for(let g=-150;g<c.height+100;g+=50)0==e%2&&d.fillRect(f-a,g-b,50,50),e++;e=0,d.fillStyle="#1a1a1a";for(let f=-150;f<c.width+100;f+=50)for(let g=-150;g<c.height+100;g+=50)1==e%2&&d.fillRect(f-a,g-b,50,50),e++}function drawCounter(a){let b=document.getElementById("canvas"),c=b.getContext("2d");c.fillStyle="#ffffff",c.font="80px Arial",c.fillRect(b.width-90,10,80,80),c.fillStyle="#000000",c.fillText(a,b.width-80,80)}function drawObjects(a){let b=document.getElementById("canvas"),c=b.getContext("2d");if("rectangles"===a){for(let d=0;d<objects[a].length;d++)if(!objects[a][d].bottomBarrier){c.fillStyle=objects[a][d].color;let e=b.width/2+-cameraPos.x+objects[a][d].startx,f=b.height/2+-cameraPos.y+-objects[a][d].starty,g=b.width/2+-cameraPos.x+objects[a][d].endx,h=b.height/2+-cameraPos.y+-objects[a][d].endy;c.fillRect(e,f,g-e,h-f)}for(let d=0;d<objects[a].length;d++)if(objects[a][d].bottomBarrier){c.fillStyle=objects[a][d].color;let e=b.width/2+-cameraPos.x+objects[a][d].startx,f=b.height/2+-cameraPos.y+-objects[a][d].starty,g=b.width/2+-cameraPos.x+objects[a][d].endx,h=b.height/2+-cameraPos.y+-objects[a][d].endy;c.fillRect(e,f,g-e,h-f)}}else if("spikes"===a)for(let d=0;d<objects[a].length;d++){c.fillStyle=objects[a][d].color;let e=b.width/2+-cameraPos.x+objects[a][d].points[0][0],f=b.height/2+-cameraPos.y+-objects[a][d].points[0][1],g=b.width/2+-cameraPos.x+objects[a][d].points[1][0],h=b.height/2+-cameraPos.y+-objects[a][d].points[1][1],i=b.width/2+-cameraPos.x+objects[a][d].points[2][0],j=b.height/2+-cameraPos.y+-objects[a][d].points[2][1];c.beginPath(),c.moveTo(e,f),c.lineTo(g,h),c.lineTo(i,j),c.closePath(),c.fill()}else if("circles"===a)for(let d=0;d<objects[a].length;d++){c.fillStyle=objects[a][d].color;let e=b.width/2+-cameraPos.x+objects[a][d].x,f=b.height/2+-cameraPos.y+-objects[a][d].y,g=objects[a][d].radius;c.beginPath(),c.arc(e,f,g,0,2*Math.PI),c.fill()}else throw new Error(`drawObjects: type ${a} is not a valid shape name`)}function drawPlayer(){let a=document.getElementById("canvas"),b=a.getContext("2d");b.fillStyle="#3366ff";let c=a.width/2+-cameraPos.x+playerPos.x,d=a.height/2+-cameraPos.y+playerPos.y;b.fillRect(c,d,playerSize,playerSize)}function drawGameOver(){let a=document.getElementById("canvas"),b=document.createElement("div");a.onclick=()=>{startGame(new Date().toString(),1.5)},b.innerHTML="<span style=\"font-family:monospace; font-size: 40px; color: white\"><p>Game Over</p><p>Score: "+Math.floor(distanceToOrgin(playerPos.x,playerPos.y))+"</p><p>Click anywhere to play again</p></span>",domtoimage.toSvg(b,{width:a.width,height:a.height}).then(a=>{var b=new Image;b.src=a;let c=document.getElementById("canvas"),d=c.getContext("2d");d.fillStyle="#000000aa",d.fillRect(0,0,c.width,c.height),d.drawImage(b,80,40)})}async function processTick(){let a=playerPos.x;if(keydata.any){if(keydata.arrows.up&&!jumping)jumping=!0,jump();else if(keydata.arrows.left){if(playerPos.x-=Math.floor(targetFps/playerSpeed),checkForAllCollisions("rectangles")){for(playerPos.x=a;!checkForAllCollisions("rectangles");)playerPos.x-=1;playerPos.x++}}else if(keydata.arrows.right&&(playerPos.x+=Math.floor(targetFps/playerSpeed),checkForAllCollisions("rectangles"))){for(playerPos.x=a;!checkForAllCollisions("rectangles");)playerPos.x+=1;playerPos.x--}150<Math.abs(playerPos.x-cameraPos.x)&&(cameraPos.x+=playerPos.x-a)}10<=tickNumber-jumpedTick&&(endJump(),jumping=!1),gravityData.on=!(await elevator()),gravity(),checkForAllCollisions("spikes")&&(playerPos.x=0,playerPos.y=0,gravityData.active=!0),checkForDeath()&&(playerDied=!0),objects={rectangles:[],spikes:[],circles:[]};var b=1500;for(let a=300*Math.floor(cameraPos.x/300)-1500,c=a;a<c+3750;a+=300)for(let c=300*Math.floor(-cameraPos.y/300)-b,d=c;c<d+4*b;c+=300)generateSpace(a,c);objects.rectangles.push({startx:-100,starty:-70,endx:150,endy:-50,color:"#ffffff",collide:!0}),time>mspt*headstart&&objects.circles.push({x:0,y:-50,radius:(time-mspt*headstart)*difficulty,color:"#aa000077"}),addTypesToObjects(),time++}async function fpsloop(){for(;gameRunning;)document.getElementById("fps").innerHTML="FPS: "+fps+"<br>("+mspf+" ms per frame)<br>Seed: "+base_rng_seed+"<br>Player: "+playerPos.x+", "+playerPos.y+"<br>Camera: "+cameraPos.x+", "+cameraPos.y+"<br>Score: "+Math.floor(distanceToOrgin(playerPos.x,playerPos.y)),await wait(500)}async function mainloop(){if(gameRunning&&requestAnimationFrame(mainloop),Date.now()-lastTickTime>1e3/targetFps){tickNumber++,lastTickTime=Date.now();let a=Date.now();background(cameraPos.x%100,cameraPos.y%100),drawObjects("rectangles"),drawObjects("spikes"),drawObjects("circles"),drawPlayer(),time<mspt*headstart&&drawCounter(headstart-1-Math.floor(time/mspt)),playerDied?drawGameOver():processTick();let b=Date.now();fps=Math.round(1e3/(b-a)),mspf=b-a,fps===1/0&&(fps=1001)}else skippedTicks++}Number.prototype.between=function(a,b){return this>Math.min(a,b)&&this<Math.max(a,b)};async function wait(a){return new Promise(function(b){window.setTimeout(b,a)})}function vec(a,b){return[b[0]-a[0],b[1]-a[1]]}function dot(a,b){return a[0]*b[0]+a[1]*b[1]}function pointInTriange(a,b,c,d){var e=vec(b,d),f=vec(b,c),g=vec(b,a),h=dot(e,e),i=dot(e,f),j=dot(e,g),k=dot(f,f),l=dot(f,g),m=1/(h*k-i*i),n=(k*j-i*l)*m,o=(h*l-i*j)*m;return 0<=n&&0<=o&&1>n+o}function random(a,b,c){rngsGenerated++;var d=uheprng();if(d.initState(),d.hashString(a),1>=c||!c)return d(b);var e=[];for(let f=0;f<c;f++)e.push(d(b));return e}function findAllIndexesOf(a,b){for(var c=[],d=-1;d=a.indexOf(b,d+1),-1!==d;)c.push(d);return c}function fixColorsOnElevators(){var a=getElevators();for(let b=0;b<a.length;b++)a[b].color+="77"}function getElevators(){var a=[];for(let b=0;b<objects.rectangles.length;b++)objects.rectangles[b].elevator&&a.push(objects.rectangles[b]);return a}function distanceToOrgin(a,b){return Math.sqrt(a*a+b*b)}function setScoreCookie(a){let b=new Date;b.setTime(1e15);let c=b.toUTCString();document.cookie="highscore="+a+";;expires="+c}function getHighScore(){let a=decodeURIComponent(document.cookie),b=a.indexOf("="),c=a.indexOf(";");return a.substring(b,c)}function stopGame(){gameRunning=!1}function startGame(a,b){setVars(a,b),addKeyEventListeners(),addCoordsToSpikeObjects(),addTypesToObjects(),fixColorsOnElevators(),background(playerPos.x%100,playerPos.y%100),drawObjects("rectangles"),drawObjects("spikes"),drawObjects("circles"),drawPlayer(),mainloop(),fpsloop()}startGame(new Date().toString(),1.5);function uheprng(){return function(){function b(){++j>=g&&(j=0);var a=1768863*k[j]+23283064365386963e-26*h;return k[j]=a-(h=0|a)}function c(a){return Math.floor(a*(b()+11102230246251565e-32*(0|2097152*b())))}for(var d,g=48,h=1,j=g,k=Array(g),a=0,l=Mash(),m=0;m<g;m++)k[m]=l(Math.random());return c.string=function(a){for(var b="",d=0;d<a;d++)b+=String.fromCharCode(33+c(94));return b},c.cleanString=function(a){return a=(a=(a=a.replace(/(^\s*)|(\s*$)/gi,"")).replace(/[\x00-\x1F]/gi,"")).replace(/\n /,"\n")},c.hashString=function(b){for(b=c.cleanString(b),l(b),m=0;m<b.length;m++)for(a=b.charCodeAt(m),d=0;d<g;d++)k[d]-=l(a),0>k[d]&&(k[d]+=1)},c.addEntropy=function(){var b=[];for(m=0;m<arguments.length;m++)b.push(arguments[m]);!function(){var a=Array.prototype.slice.call(arguments);for(m=0;m<a.length;m++)for(d=0;d<g;d++)k[d]-=l(a[m]),0>k[d]&&(k[d]+=1)}(a++ +new Date().getTime()+b.join("")+Math.random())},c.initState=function(){for(l(),m=0;m<g;m++)k[m]=l(" ");h=1,j=g},c.done=function(){l=null},c}()}function Mash(){var a=4022871197;return function(b){if(b){b=b.toString();for(var c,d=0;d<b.length;d++)c=.02519603282416938*(a+=b.charCodeAt(d)),c-=a=c>>>0,a=(c*=a)>>>0,a+=4294967296*(c-=a);return 23283064365386963e-26*(a>>>0)}a=4022871197}}function addCoordsToSpikeObjects(){for(let a=0;a<objects.spikes.length;a++){let b=objects.spikes[a].x,c=objects.spikes[a].y,d=objects.spikes[a].size,e=objects.spikes[a].direction;"up"===e?objects.spikes[a].points=[[b,c],[b+d,c],[b+d/2,c+d]]:"down"===e?objects.spikes[a].points=[[b,c+d],[b+d,c+d],[b+d/2,c]]:"right"===e?objects.spikes[a].points=[[b,c],[b,c+d],[b+d,c+d/2]]:"left"===e&&(objects.spikes[a].points=[[b+d,c],[b+d,c+d],[b,c+d/2]])}}function addTypesToObjects(){for(let a=0;a<objects.rectangles.length;a++)objects.rectangles[a].type="rectangles";for(let a=0;a<objects.spikes.length;a++)objects.spikes[a].type="spikes";for(let a=0;a<objects.circles.length;a++)objects.circles[a].type="circles"}function addKeyEventListeners(){document.addEventListener("keydown",function(a){"ArrowLeft"===a.code?(keydata.any=!0,keydata.arrows.left=!0):"ArrowUp"===a.code||"Space"===a.code?(keydata.any=!0,keydata.arrows.up=!0):"ArrowRight"===a.code?(keydata.any=!0,keydata.arrows.right=!0):"ArrowDown"===a.code&&(keydata.any=!0,keydata.arrows.down=!0)}),document.addEventListener("keyup",function(a){"ArrowLeft"===a.code?keydata.arrows.left=!1:"ArrowUp"===a.code||"Space"===a.code?keydata.arrows.up=!1:"ArrowRight"===a.code?keydata.arrows.right=!1:"ArrowDown"===a.code&&(keydata.arrows.down=!1),keydata.arrows.left||keydata.arrows.up||keydata.arrows.right||keydata.arrows.down||(keydata.any=!1)})}function gravity(){if(gravityData.on){gravityData.active!==gravityData.activeLastTick&&(gravityData.timeFallen=2,gravityData.prevFall=0);let b=playerPos.y;var a=0;if(gravityData.active?(a=gravityData.timeFallen**1.5+1.1,35<=a&&(a=35)):a=2.16*(-((-.5*gravityData.timeFallen+1)**2)+15),gravityData.active)for(let b=0;b<a&&!checkForAllCollisions("rectangles")&&!checkForAllElevatorCollisions();b++)playerPos.y++;else for(let b=0;b<a&&!checkForAllCollisions("rectangles")&&!checkForAllElevatorCollisions();b++)playerPos.y--;0!=a&&(gravityData.active?playerPos.y--:playerPos.y++),gravityData.active||(playerPos.y--,checkForAllCollisions("rectangles")&&(gravityData.active=!0),playerPos.y++),playerPos.y===b?(gravityData.timeFallen=2,gravityData.prevFall=0):(gravityData.timeFallen++,gravityData.prevFall=a),150<Math.abs(playerPos.y-cameraPos.y)&&(cameraPos.y+=playerPos.y-b),gravityData.activeLastTick=gravityData.active}}async function elevator(){return new Promise(a=>{var b=getElevators();for(let c=0;c<b.length;c++)if("elevator"===checkForPlayerCollision(b[c])){for(let d=0;24>d;d++)if(playerPos.y-=1,checkForAllCollisions("rectangles")||"none"===checkForPlayerCollision(b[c])){"none"===checkForPlayerCollision(b[c])&&(playerPos.y+=1,a(!1)),playerPos.y+=1;break}a(!0)}a(!1)})}function jump(){jumpedTick=tickNumber,playerPos.y++,checkForAllCollisions("rectangles")||checkForAllElevatorCollisions()?(playerPos.y--,gravityData.active=!1):playerPos.y--}function endJump(){gravityData.active=!0}function generateLineData(a){var b,c,d,e,f,g,h,i,j,k=random(a,100,10),l=random(a+" ",1e3,150),m={},n=a.split("_____");return(n[1]=+n[1],n[2]=+n[2],m.seed=a,m.numbers=k,m.availibleNumbers=l,0==n[1]/100%2-n[2]/100%2)?(m.line=!1,m):(m.line=!0,c=k[0]<generatorConfig.rightChance?"right":"left",m.direction=c,b=k[1]<generatorConfig.smallSlopeChance?k[2]/(100/(1-generatorConfig.minSlope))+generatorConfig.minSlope:k[2]/(100/(1-generatorConfig.maxSlope))+generatorConfig.maxSlope,m.slope=b.toFixed(2),d=k[3]/(100/(generatorConfig.maxLength-generatorConfig.minLength))+generatorConfig.minLength,m.length=Math.floor(d),e=k[4]/(100/(generatorConfig.maxBlockDensity-generatorConfig.minBlockDensity))+generatorConfig.minBlockDensity,m.blockDensity=e.toFixed(2),f=k[5]/(100/(generatorConfig.maxLineHeight-generatorConfig.minLineHeight))+generatorConfig.minLineHeight,m.thickness=Math.floor(f),g=k[6]/(100/(generatorConfig.maxSpikeBlockChance-generatorConfig.minSpikeBlockChance))+generatorConfig.minSpikeBlockChance,m.spikedBlockChance=g.toFixed(2),h=k[7]/(100/(generatorConfig.maxRandomSpikeChance-generatorConfig.minRandomSpikeChance))+generatorConfig.minRandomSpikeChance,m.freeSpikeDensity=h.toFixed(2),i=k[8]/(100/(generatorConfig.maxBlockWidth-generatorConfig.minBlockWidth))+generatorConfig.minBlockWidth,m.blockWidth=Math.floor(i),j=generatorConfig.colors.rectanglesNormal[k[8]%generatorConfig.colors.rectanglesNormal.length],m.color=j,m)}function generateSpace(a,b){if(0==a%300&&0==b%300){var c=base_rng_seed+"_____"+a+"_____"+b;rngData[c]===void 0&&(rngData[c]=random(c,68719476736)),lineData[c]===void 0&&(lineData[c]=generateLineData(c));var d=lineData[c];if(d.line){var e,f;for(let c=0;c<Math.floor(d.blockDensity);c++)(e=Math.floor(a+d.length*d.slope*(c/d.blockDensity)+d.availibleNumbers[c]/(1e3/generatorConfig.crazyness)),"left"===d.direction&&0<d.slope&&(d.slope=-d.slope),f=Math.floor(d.slope*(e+-a)+b),!(150>Math.abs(e)&&150>Math.abs(f)))&&(block={color:d.color,startx:e,starty:f,endx:Math.floor(e+d.blockWidth),endy:Math.floor(f+generatorConfig.blockHeight),collide:!0,elevator:!1},objects.rectangles.push(block))}objects.rectangles.push({color:"#000000",startx:a,starty:Math.abs(.8*a)-1200,endx:a+600,endy:Math.abs(.8*a)-2200,collide:!0,bottomBarrier:!0})}else throw new Error(`Unable to generate spaces at ${a}, ${b}. Location not divisible by 300.`)}function checkForPlayerCollision(a){return checkForCollision(a,playerPos.x,playerPos.y,playerSize,playerSize)}function checkForAllCollisions(a){if("rectangles"===a){for(let b=0;b<objects[a].length;b++)if("normal"===checkForPlayerCollision(objects[a][b]))return!0;}else if("spikes"===a){for(let b=0;b<objects[a].length;b++)if("normal"===checkForPlayerCollision(objects[a][b]))return!0;}else throw new Error(`checkForAllCollisions: type ${a} is not a valid shape name`);return!1}function checkForAllElevatorCollisions(){var a=getElevators();for(let b=0;b<a.length;b++)if("elevator"===checkForPlayerCollision(a[b]))return!0;return!1}function checkForCollision(a,b,c,d,e){if(collisionschecked++,a.collide||a.elevator){if("rectangles"===a.type)return b<a.endx&&b+e>a.startx&&((-c).between(a.starty,a.endy)||(-c-d).between(a.starty,a.endy)||a.starty.between(-c,-c-d)||a.endy.between(-c,-c-d))?a.elevator?"elevator":"normal":"none";if("spikes"===a.type)return a.points[0][0].between(b,b+e)&&a.points[0][1].between(-c,-c-d)||a.points[1][0].between(b,b+e)&&a.points[1][1].between(-c,-c-d)||a.points[2][0].between(b,b+e)&&a.points[2][1].between(-c,-c-d)?"normal":pointInTriange([b,-c],[a.points[0][0],a.points[0][1]],[a.points[1][0],a.points[1][1]],[a.points[2][0],a.points[2][1]])||pointInTriange([b+e,-c],[a.points[0][0],a.points[0][1]],[a.points[1][0],a.points[1][1]],[a.points[2][0],a.points[2][1]])||pointInTriange([b,-c-d],[a.points[0][0],a.points[0][1]],[a.points[1][0],a.points[1][1]],[a.points[2][0],a.points[2][1]])||pointInTriange([b+e,-c-d],[a.points[0][0],a.points[0][1]],[a.points[1][0],a.points[1][1]],[a.points[2][0],a.points[2][1]])?"normal":"none";throw new Error(`Failed to do collision check, object has type ${a.type} which is invalid`)}else return"none"}function checkForDeath(){let a=(time-mspt*headstart)*difficulty;return!!(distanceToOrgin(playerPos.x,playerPos.y)<a||distanceToOrgin(playerPos.x+playerSize,playerPos.y)<a||distanceToOrgin(playerPos.x,playerPos.y-playerSize)<a||distanceToOrgin(playerPos.x+playerSize,playerPos.y-playerSize)<a)}